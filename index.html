<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´ ê°œì¸ì •ë³´ ì´ìš© ë™ì˜ì„œ</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .intro {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #667eea;
        }

        .intro p {
            font-size: 14px;
            color: #495057;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }

        .section-content {
            font-size: 14px;
            color: #4a5568;
            padding-left: 10px;
        }

        .section-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .section-content li {
            margin: 8px 0;
        }

        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }

        .highlight-box strong {
            color: #856404;
        }

        .consent-box {
            background: #f8f9fa;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
        }

        .consent-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }

        .radio-group {
            margin: 15px 0;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            background: #f7fafc;
            border-color: #cbd5e0;
        }

        .radio-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
        }

        .radio-option label {
            font-size: 16px;
            cursor: pointer;
            flex: 1;
        }

        .radio-option.agree {
            border-color: #667eea;
        }

        .radio-option.disagree {
            border-color: #cbd5e0;
        }

        input[type="radio"]:checked + label {
            font-weight: bold;
        }

        .signature-section {
            margin-top: 30px;
            display: none;
        }

        .signature-section.active {
            display: block;
        }

        .signature-label {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #2d3748;
        }

        .signature-canvas-wrapper {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            background: #ffffff;
            padding: 10px;
            margin-bottom: 15px;
        }

        #signatureCanvas {
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            cursor: crosshair;
            display: block;
            touch-action: none;
        }

        .signature-info {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .signature-info input {
            flex: 1;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 6px;
            font-size: 14px;
        }

        .signature-info input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        button {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-clear {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-clear:hover {
            background: #cbd5e0;
        }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-submit:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .guardian-section {
            margin-top: 20px;
            padding: 20px;
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            border-radius: 8px;
            display: none;
        }

        .guardian-section.active {
            display: block;
        }

        .guardian-section h4 {
            color: #0050b3;
            margin-bottom: 15px;
        }

        .guardian-info {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .guardian-info input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid #91d5ff;
            border-radius: 6px;
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 40px;
            border-radius: 12px;
            max-width: 500px;
            text-align: center;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .modal-content p {
            margin-bottom: 30px;
            color: #4a5568;
        }

        .modal-content button {
            width: 100%;
            margin-top: 10px;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #6c757d;
            font-size: 13px;
        }

        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
            }

            .content {
                padding: 20px;
            }

            .signature-info,
            .guardian-info {
                flex-direction: column;
            }

            .button-group {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h1>
            <p>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´ (ìˆ˜ë¯¸í—¬ìŠ¤)</p>
        </div>

        <div class="content">
            <div class="intro">
                <p><strong>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤)</strong>ëŠ” ã€Œê°œì¸ì •ë³´ ë³´í˜¸ë²•ã€ ì œ15ì¡°(ê°œì¸ì •ë³´ì˜ ìˆ˜ì§‘Â·ì´ìš©) ë° ì œ23ì¡°(ë¯¼ê°ì •ë³´ì˜ ì²˜ë¦¬ ì œí•œ)ì— ë”°ë¼, ìˆ˜ë©´ë¬´í˜¸í¡ì¦ í†µí•© ì¼€ì–´ í”„ë¡œê·¸ë¨ ì œê³µì„ ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ ê·€í•˜ì˜ ê°œì¸ì •ë³´ ë° ê±´ê°• ê´€ë ¨ ë¯¼ê°ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë™ì˜ë¥¼ ë°›ê³  ìˆìŠµë‹ˆë‹¤. ë³¸ ë™ì˜ì„œëŠ” ë²•ë ¹ì— ë”°ë¥¸ í•„ìˆ˜ ì ˆì°¨ë¡œ, ê·€í•˜ì˜ ê°œì¸ì •ë³´ ìê¸°ê²°ì •ê¶Œ ë³´ì¥ ë° ì ë²•í•œ ì •ë³´ ì²˜ë¦¬ë¥¼ ìœ„í•´ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            </div>

            <div class="section">
                <div class="section-title">1. ìˆ˜ì§‘Â·ì´ìš© ëª©ì </div>
                <div class="section-content">
                    <strong>ìˆ˜ë©´ë¬´í˜¸í¡ì¦ ì§„ë‹¨ ë° ì¹˜ë£Œ ì§€ì›</strong>
                    <ul>
                        <li>PSG(ìˆ˜ë©´ë‹¤ì›ê²€ì‚¬) ê²°ê³¼ í™•ì¸ ë° í•´ì„ ì§€ì›</li>
                        <li>ì–‘ì••ê¸° ë° ê¸°íƒ€ ì¹˜ë£Œ(ì˜ˆ: êµ¬ê°•ì¥ì¹˜ ë“±) ê³„íš ìˆ˜ë¦½ ë° ì¡°ì •</li>
                        <li>Mask fit(ë§ˆìŠ¤í¬ ì í•©ë„) í‰ê°€ ë° ë§ˆìŠ¤í¬ ì„ íƒÂ·êµì²´ ì§€ì›</li>
                        <li>ì–‘ì••ê¸° titration(ì••ë ¥ ì„¤ì •) ë°ì´í„° í™•ì¸ ë° ìµœì  ì••ë ¥ ì¡°ì • ì§€ì›</li>
                        <li>ì–‘ì••ê¸° ë° ê¸°íƒ€ ì¹˜ë£Œê¸°ê¸° ì‚¬ìš© í˜„í™© ëª¨ë‹ˆí„°ë§ ë° ìˆœì‘ë„ ê´€ë¦¬(ì•Œë¦¼, ì½”ì¹­ ë“±)</li>
                    </ul>

                    <strong>ë§ì¶¤í˜• ì¼€ì–´Â·êµìœ¡ ì œê³µ</strong>
                    <ul>
                        <li>ê²€ì‚¬Â·ì¹˜ë£Œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë§ì¶¤í˜• ì„¤ëª…Â·ë¦¬í¬íŠ¸ ì œê³µ</li>
                        <li>ìˆ˜ë©´Â·ìˆ˜ë©´ë¬´í˜¸í¡ì¦Â·ì¹˜ë£ŒÂ·ë³´í—˜ ê´€ë ¨ ì•ˆë‚´ ë° Q&A ì§€ì›(SOOMi Chatbot í¬í•¨)</li>
                    </ul>

                    <strong>ì„œë¹„ìŠ¤ í’ˆì§ˆê´€ë¦¬ ë° ê°œì„ </strong>
                    <ul>
                        <li>ì¹˜ë£Œ ìˆœì‘ë„ ë° ì¦ìƒ ê°œì„  ë°ì´í„° ë¶„ì„</li>
                        <li>ë‚´ë¶€ í†µê³„Â·ë¶„ì„ì„ í†µí•œ í”„ë¡œê·¸ë¨Â·ì„œë¹„ìŠ¤ ê°œì„ </li>
                    </ul>

                    <strong>ê³ ê° ì§€ì› ë° ë¬¸ì˜ ì‘ëŒ€</strong>
                    <ul>
                        <li>ì„œë¹„ìŠ¤ ê´€ë ¨ ë¬¸ì˜ ë° ë¶ˆí¸ì‚¬í•­ ì²˜ë¦¬</li>
                        <li>ë³¸ì¸ í™•ì¸ ë° ìƒë‹´ ì§€ì›</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">2. ìˆ˜ì§‘Â·ì´ìš© í•­ëª©</div>
                <div class="section-content">
                    <strong>[1] ì¼ë°˜ ê°œì¸ì •ë³´</strong>
                    <ul>
                        <li>ì„±ëª…, ìƒë…„ì›”ì¼, ì„±ë³„</li>
                        <li>ì—°ë½ì²˜(íœ´ëŒ€ì „í™” ë²ˆí˜¸, ì´ë©”ì¼)</li>
                        <li>ë³‘ì› ê³ ê°ë²ˆí˜¸ ë“± í”„ë¡œê·¸ë¨ ìš´ì˜ì— í•„ìš”í•œ ì‹ë³„ ì •ë³´</li>
                    </ul>

                    <strong>[2] ê±´ê°• ê´€ë ¨ ë¯¼ê°ì •ë³´</strong>
                    <ul>
                        <li>PSG(ìˆ˜ë©´ë‹¤ì›ê²€ì‚¬) ê²°ê³¼ ì „ë°˜ (AHI(ìˆ˜ë©´ë¬´í˜¸í¡ì €í˜¸í¡ì§€ìˆ˜), ì‚°ì†Œí¬í™”ë„, ìˆ˜ë©´ ë‹¨ê³„, ì²´ìœ„ ë³€í™”, PLM(ì‚¬ì§€ ì›€ì§ì„) ë“±)</li>
                        <li>ì–‘ì••ê¸° ë° ê´€ë ¨ ê²€ì‚¬/ì„¤ì • ë°ì´í„° (ì–‘ì••ê¸° titration ê²°ê³¼, Mask fit í‰ê°€, ì‚¬ìš© ë§ˆìŠ¤í¬ ì¢…ë¥˜Â·ì‚¬ì´ì¦ˆ, ì••ë ¥ ê¸°ë¡, ëˆ„ì¶œ, ì”ì—¬ AHI(ìˆ˜ë©´ë¬´í˜¸í¡ì €í˜¸í¡ì§€ìˆ˜) ë“±)</li>
                        <li>ì‹¤ì œ ì–‘ì••ê¸° ì‚¬ìš© ë°ì´í„° (ì‚¬ìš© ì‹œê°„, ì‚¬ìš© ì¼ìˆ˜, ìˆœì‘ë„ ì—¬ë¶€, ë¶ˆí¸ê°Â·ë¶€ì‘ìš©ì— ëŒ€í•œ ë³´ê³  ë“±)</li>
                        <li>ìˆ˜ë©´ ê´€ë ¨ ì„¤ë¬¸ ë° ê¸°ë¡ (STOP-BANG(ìˆ˜ë©´ë¬´í˜¸í¡ì¦ ìœ„í—˜ë„ í‰ê°€), Epworth ì¡¸ë¦¼ì²™ë„, ìˆ˜ë©´ìŠµê´€, ë™ë°˜ì§ˆí™˜, ë³µìš©ì•½ ë“± ê³ ê°ì´ ì§ì ‘ ì…ë ¥í•˜ê³  ì œì¶œí•œ ì •ë³´ì— í•œí•¨)</li>
                    </ul>

                    <div class="highlight-box">
                        <strong>â€» ì•ˆë‚´:</strong> ì‹¤ì œ ìˆ˜ì§‘ í•­ëª©ì€ ì§„ë£Œê¸°ê´€Â·ì‚¬ìš© ì¥ë¹„ ë° í”„ë¡œê·¸ë¨ êµ¬ì„±ì— ë”°ë¼ ì¼ë¶€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ê·¸ ê²½ìš° ë³„ë„ ì•ˆë‚´ í›„ ìµœì†Œí•œì˜ ë²”ìœ„ ë‚´ì—ì„œ ìˆ˜ì§‘Â·ì´ìš©í•©ë‹ˆë‹¤.
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">3. ë³´ìœ Â·ì´ìš© ê¸°ê°„</div>
                <div class="section-content">
                    <ul>
                        <li>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) í”„ë¡œê·¸ë¨ ì°¸ì—¬ ê¸°ê°„ ë™ì•ˆ ë° ì°¸ì—¬ ì¢…ë£Œ í›„ <strong>5ë…„ê°„</strong> ë³´ê´€ (ì°¸ê³ : ì˜ë£Œë²•ìƒ ì§„ë£Œê¸°ë¡ ë³´ê´€ - 10ë…„)</li>
                        <li>ê´€ë ¨ ë²•ë ¹(ì˜ˆ: ì˜ë£Œ ê´€ë ¨ ë²•ë ¹, ê°œì¸ì •ë³´ ë³´í˜¸ë²• ë“±)ì— ë”°ë¼ ë” ê¸´ ê¸°ê°„ ë³´ì¡´ì´ í•„ìš”í•œ ê²½ìš°, í•´ë‹¹ ë²•ë ¹ì—ì„œ ì •í•œ ê¸°ê°„ ë™ì•ˆ ë³´ê´€Â·ì´ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>í†µê³„Â·ì—°êµ¬ ëª©ì ìœ¼ë¡œ í™œìš©í•˜ëŠ” ê²½ìš°, ê°œì¸ì„ ì§ì ‘ ì‹ë³„í•  ìˆ˜ ì—†ë„ë¡ ì™„ì „íˆ ìµëª… ì²˜ë¦¬í•œ í›„ì—ë§Œ í™œìš©í•˜ë©°, ì´ ê²½ìš°ì—ë„ ê·€í•˜ëŠ” ì–¸ì œë“ ì§€ ì‚­ì œë¥¼ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">4. ì œ3ì ì œê³µ</div>
                <div class="section-content">
                    <strong>1) ì§„ë£Œ ë° í”„ë¡œê·¸ë¨ ìš´ì˜ì„ ìœ„í•œ ì œê³µ</strong>
                    <ul>
                        <li><strong>ì œê³µ ëŒ€ìƒ:</strong> ê³ ê°ì´ ê²€ì‚¬Â·ì§„ë£Œë¥¼ ë°›ì€ ìˆ˜ë©´í´ë¦¬ë‹‰ ë˜ëŠ” ë³‘ì›, ì¹˜ë£Œê¸°ê¸° ë° ì†Œëª¨í’ˆ ê³µê¸‰ì‚¬(DME) ë“±</li>
                        <li><strong>ì œê³µ ëª©ì :</strong> ì§„ë‹¨Â·ì¹˜ë£ŒÂ·ê²€ì‚¬ ë° í”„ë¡œê·¸ë¨ ìš´ì˜, ì¥ë¹„ ì„¸íŒ…Â·ìœ ì§€ê´€ë¦¬, ê¸°ìˆ  ì§€ì› ë“±</li>
                        <li><strong>ì œê³µ í•­ëª©:</strong> ìœ„ 2ì¡°ì—ì„œ ëª…ì‹œí•œ ì •ë³´ ì¤‘, ì—…ë¬´ ìˆ˜í–‰ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ë²”ìœ„</li>
                        <li><strong>ë³´ìœ Â·ì´ìš© ê¸°ê°„:</strong> ìƒê¸° 3ì¡°ì˜ ë³´ìœ  ê¸°ê°„ ë˜ëŠ” ê´€ë ¨ ë²•ë ¹ì—ì„œ ì •í•œ ê¸°ê°„</li>
                    </ul>

                    <strong>2) ë²•ë ¹ì— ë”°ë¥¸ ì œê³µ</strong>
                    <ul>
                        <li>ë²•ë¥ ì— íŠ¹ë³„í•œ ê·œì •ì´ ìˆëŠ” ê²½ìš°</li>
                        <li>ìˆ˜ì‚¬ê¸°ê´€Â·ê°ë…ê¸°ê´€Â·ë²•ì› ë“±ì˜ ì ë²•í•œ ìš”ì²­ì´ ìˆëŠ” ê²½ìš° ë“±</li>
                        <li>ì´ ê²½ìš°ì—ëŠ” ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ë³„ë„ ë™ì˜ ì—†ì´ ì œê³µë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">5. ì •ë³´ì£¼ì²´ì˜ ê¶Œë¦¬</div>
                <div class="section-content">
                    <p>ê·€í•˜ëŠ” ì–¸ì œë“ ì§€ ë³¸ì¸ì— ê´€í•œ ë‹¤ìŒ ì‚¬í•­ì— ëŒ€í•´ ìˆ˜ë¯¸í—¬ìŠ¤(SOOMi Health, ì´ë©”ì¼: contact@ksleep.care / ì „í™”: 010-9796-2513)ì— ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
                    <ul>
                        <li>ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ì—´ëŒ</li>
                        <li>ì •ì •Â·ì‚­ì œ ìš”ì²­</li>
                        <li>ì²˜ë¦¬ ì •ì§€ ìš”ì²­(ë²•ë ¹ìƒ ì œí•œì´ ìˆëŠ” ê²½ìš° ì œì™¸)</li>
                    </ul>
                    <p style="margin-top: 10px;">ìœ„ ê¶Œë¦¬ë¥¼ í–‰ì‚¬í•˜ê³ ì í•  ë•Œì—ëŠ” ìˆ˜ë¯¸í—¬ìŠ¤(SOOMi Health)ì˜ ê°œì¸ì •ë³´ ë³´í˜¸ì±…ì„ì ë˜ëŠ” ê³ ê°ì§€ì› ì±„ë„ì„ í†µí•´ ìš”ì²­í•˜ì‹¤ ìˆ˜ ìˆìœ¼ë©°, ìˆ˜ë¯¸í—¬ìŠ¤(SOOMi Health)ëŠ” ê´€ë ¨ ë²•ë ¹ì—ì„œ ì •í•œ ì ˆì°¨ì™€ ê¸°í•œ ë‚´ì— ì„±ì‹¤íˆ ë‹µë³€Â·ì¡°ì¹˜í•©ë‹ˆë‹¤.</p>
                </div>
            </div>

            <div class="section" style="background: linear-gradient(135deg, #FEE500 0%, #FFE14D 100%); padding: 25px; border-radius: 12px; border: 3px solid #FAE100; box-shadow: 0 4px 15px rgba(250, 225, 0, 0.3);">
                <div class="section-title" style="color: #3C1E1E; border-left-color: #3C1E1E; font-size: 20px;">ğŸ’¬ 6. ì¹´ì¹´ì˜¤í†¡ ì±„ë„ì„ í†µí•œ ì •ë³´ ìˆ˜ì‹  ë™ì˜ (ì„ íƒ)</div>
                <div class="section-content" style="color: #3C1E1E;">
                    <p style="margin-bottom: 15px; font-weight: 600;">ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) ì¹´ì¹´ì˜¤í†¡ ì±„ë„ì„ í†µí•´ ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ë¥¼ ìˆ˜ì‹ í•˜ëŠ” ê²ƒì— ë™ì˜í•˜ì‹­ë‹ˆê¹Œ?</p>
                    <ul style="margin-bottom: 15px;">
                        <li>ê²€ì‚¬ ê²°ê³¼, ì¹˜ë£Œ ì§„í–‰ ìƒí™©, ìˆœì‘ë„ ë¦¬í¬íŠ¸ ë“± í”„ë¡œê·¸ë¨ ê´€ë ¨ ì•ˆë‚´</li>
                        <li>ì–‘ì••ê¸° ì‚¬ìš©ë²•, ê´€ë¦¬ ë°©ë²•, ë¬¸ì œ í•´ê²° ë“± êµìœ¡ ìë£Œ</li>
                        <li>ì˜ˆì•½ ì•ˆë‚´, í”„ë¡œê·¸ë¨ ì¼ì •, ì¤‘ìš” ê³µì§€ì‚¬í•­</li>
                        <li>ìˆ˜ë©´Â·ìˆ˜ë©´ë¬´í˜¸í¡ì¦Â·ì¹˜ë£ŒÂ·ë³´í—˜ ê´€ë ¨ Q&A ë° ìƒë‹´ ì§€ì›</li>
                    </ul>
                    <div style="margin-top: 20px; padding: 20px; background: #3C1E1E; border-radius: 8px; border: 2px solid #000;">
                        <label style="display: flex; align-items: center; cursor: pointer;">
                            <input type="checkbox" id="kakaoConsent" style="width: 22px; height: 22px; margin-right: 12px; cursor: pointer; accent-color: #FEE500;">
                            <span style="font-size: 16px; font-weight: 700; color: #FEE500;">âœ“ ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) ì¹´ì¹´ì˜¤í†¡ ì±„ë„ì„ í†µí•œ ì •ë³´ ìˆ˜ì‹ ì— ë™ì˜í•©ë‹ˆë‹¤ (ì„ íƒ)</span>
                        </label>
                        <p style="margin-top: 12px; font-size: 13px; color: #FFE14D;">
                            â€» ë™ì˜í•˜ì§€ ì•Šë”ë¼ë„ ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) í”„ë¡œê·¸ë¨ ì´ìš©ì—ëŠ” ì œí•œì´ ì—†ìŠµë‹ˆë‹¤.<br>
                            â€» í”„ë¡œê·¸ë¨ ì¢…ë£Œ ì‹œ ì¹´ì¹´ì˜¤í†¡ ì±„ë„ì„ í†µí•œ ì •ë³´ ìˆ˜ì‹ ë„ ìë™ìœ¼ë¡œ ì¢…ë£Œë©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">7. ë™ì˜ ê±°ë¶€ ê¶Œë¦¬ ë° ë¶ˆì´ìµ ì•ˆë‚´</div>
                <div class="section-content">
                    <ul>
                        <li>ê·€í•˜ëŠ” ìœ„ ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ë‹¤ë§Œ, ë™ì˜ë¥¼ ê±°ë¶€í•˜ì‹¤ ê²½ìš°:
                            <ul>
                                <li>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) í”„ë¡œê·¸ë¨ì˜ ì¼ë¶€ ë˜ëŠ” ì „ì²´ ì´ìš©ì´ ì œí•œë  ìˆ˜ ìˆìœ¼ë©°,</li>
                                <li>ê²€ì‚¬Â·ì¹˜ë£Œ ë°ì´í„° ê¸°ë°˜ ë§ì¶¤í˜• ì¼€ì–´ ë° ìˆœì‘ë„ ê´€ë¦¬ ì„œë¹„ìŠ¤ ì œê³µì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                            </ul>
                        </li>
                        <li>ë³‘ì›ì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì§„ë£ŒÂ·ê²€ì‚¬ ìì²´ëŠ” í•´ë‹¹ ì˜ë£Œê¸°ê´€ì˜ ì •ì±… ë° ë™ì˜ì„œì— ë”°ë¥´ë©°, ë³¸ ë™ì˜ ì—¬ë¶€ì™€ëŠ” ë³„ë„ë¡œ ìš´ì˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">8. ë§Œ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì˜ ê²½ìš°</div>
                <div class="section-content">
                    <ul>
                        <li>ë§Œ 14ì„¸ ë¯¸ë§Œ ì•„ë™ì´ ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) í”„ë¡œê·¸ë¨ì— ì°¸ì—¬í•˜ëŠ” ê²½ìš°, ë°˜ë“œì‹œ ë²•ì •ëŒ€ë¦¬ì¸(ë¶€ëª¨ ë“±)ì˜ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.</li>
                        <li>ì•„ë˜ì—ì„œ ë²•ì •ëŒ€ë¦¬ì¸ì˜ ì„±ëª… ë° ì—°ë½ì²˜ë¥¼ ì¶”ê°€ë¡œ ì…ë ¥í•´ ì£¼ì„¸ìš”.</li>
                    </ul>
                </div>
            </div>

            <div class="consent-box">
                <div class="consent-title">9. ë™ì˜ ì—¬ë¶€ ì„ íƒ</div>
                <p style="text-align: center; margin-bottom: 20px; color: #4a5568;">ìœ„ ë‚´ìš©ì„ ëª¨ë‘ í™•ì¸í•˜ì˜€ìœ¼ë©°, ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì—</p>

                <div class="radio-group">
                    <div class="radio-option disagree">
                        <input type="radio" id="disagree" name="consent" value="disagree">
                        <label for="disagree">ë™ì˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤</label>
                    </div>
                    <div class="radio-option agree">
                        <input type="radio" id="agree" name="consent" value="agree">
                        <label for="agree">ë™ì˜í•©ë‹ˆë‹¤ (í•„ìˆ˜)</label>
                    </div>
                </div>
            </div>

            <div class="signature-section" id="signatureSection">
                <div class="signature-label">ê³ ê° ì •ë³´</div>
                <div class="signature-info">
                    <input type="text" id="patientName" placeholder="ê³ ê° ì„±ëª…" required>
                    <input type="number" id="patientBirth" placeholder="ê³ ê° ìƒë…„ (ì˜ˆ: 1990)" min="1900" max="2025" required>
                </div>

                <div class="guardian-section" id="guardianSection">
                    <h4>ë²•ì •ëŒ€ë¦¬ì¸ ì •ë³´ (ë§Œ 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš°)</h4>
                    <div class="guardian-info">
                        <input type="text" id="guardianName" placeholder="ë²•ì •ëŒ€ë¦¬ì¸ ì„±ëª…">
                        <input type="tel" id="guardianPhone" placeholder="ë²•ì •ëŒ€ë¦¬ì¸ ì—°ë½ì²˜">
                        <input type="text" id="guardianRelation" placeholder="ê´€ê³„ (ì˜ˆ: ë¶€, ëª¨)">
                    </div>
                </div>

                <div class="signature-label" style="margin-top: 25px;">ì„œëª…</div>
                <p style="font-size: 13px; color: #718096; margin-bottom: 10px;">ì•„ë˜ ë°•ìŠ¤ ì•ˆì— ë§ˆìš°ìŠ¤ë‚˜ í„°ì¹˜ë¡œ ì„œëª…í•´ ì£¼ì„¸ìš”.</p>
                <div class="signature-canvas-wrapper">
                    <canvas id="signatureCanvas" width="740" height="200"></canvas>
                </div>

                <div class="button-group">
                    <button type="button" class="btn-clear" onclick="clearSignature()">ì„œëª… ì§€ìš°ê¸°</button>
                    <button type="button" class="btn-submit" id="submitBtn" onclick="submitForm()" disabled>ë™ì˜í•˜ê³  ì œì¶œí•˜ê¸°</button>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>ìˆ˜ë¯¸í—¬ìŠ¤(SOOMi Health)</strong> | ì„œë¹„ìŠ¤ëª…: ì¼€ì´ìŠ¬ë¦½ì¼€ì–´</p>
            <p>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 889-43-01165 | ëŒ€í‘œìëª…Â·ê°œì¸ì •ë³´ë³´í˜¸ì±…ì„ì: ê¹€ì—°ì¬</p>
            <p>ì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ì˜ë“±í¬êµ¬ ì–‘í‰ë¡œ 24, 5ì¸µ (Korea)</p>
            <p>ì´ë©”ì¼: contact@ksleep.care | ì „í™”: 010-9796-2513</p>
            <p style="margin-top: 15px; font-size: 12px; color: #999;">CopyrightÂ© 2025 ìˆ˜ë¯¸í—¬ìŠ¤ All rights reserved</p>
        </div>
    </div>

    <div id="successModal" class="modal">
        <div class="modal-content">
            <h2>âœ“ ë™ì˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤</h2>
            <p>ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.</p>
            <div id="receiptInfo" style="background: #f8f9fa; padding: 15px; margin: 20px 0; border-radius: 8px; text-align: left;">
                <p style="font-size: 14px; color: #495057; margin-bottom: 10px;">
                    <strong>ì œì¶œ ì •ë³´</strong>
                </p>
                <p style="font-size: 13px; color: #6c757d; margin: 5px 0;">
                    â€¢ ì œì¶œ ID: <span id="receiptId"></span>
                </p>
                <p style="font-size: 13px; color: #6c757d; margin: 5px 0;">
                    â€¢ ì œì¶œ ì‹œê°: <span id="receiptTime"></span>
                </p>
                <p style="font-size: 13px; color: #6c757d; margin: 5px 0;">
                    â€¢ ì¦ë¹™ ì½”ë“œ: <span id="receiptHash" style="font-family: monospace; font-size: 11px;"></span>
                </p>
            </div>
            <p style="font-size: 13px; color: #48bb78; margin-bottom: 15px; font-weight: 600;">
                âœ… ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
            </p>
            <p style="font-size: 12px; color: #6c757d; margin-bottom: 15px;">
                â€» ë™ì˜ì„œ í™•ì¸ì„œê°€ ì´ë©”ì¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                ì´ë©”ì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”. ê°ì‚¬í•©ë‹ˆë‹¤.
            </p>
            <button class="btn-submit" onclick="closeModal()">í™•ì¸</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase ì„¤ì •
        const SUPABASE_URL = 'https://clljgqrbqwexqhketdcu.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNsbGpncXJicXdleHFoa2V0ZGN1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1MjkwMTMsImV4cCI6MjA3OTEwNTAxM30.v6HHE5zjX38LrqzBkpHHTfs_qB1cFwnmJ-JRHxJCU8I';
        const RESEND_API_KEY = 're_5idJkR12_Aqne8skEWQiYjTfVsnGavcJ5';

        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        const canvas = document.getElementById('signatureCanvas');
        const ctx = canvas.getContext('2d');
        const signatureSection = document.getElementById('signatureSection');
        const submitBtn = document.getElementById('submitBtn');
        const guardianSection = document.getElementById('guardianSection');

        let isDrawing = false;
        let hasSignature = false;
        let submittedData = null;  // ì œì¶œëœ ë°ì´í„° ì €ì¥
        let patientData = null;  // í† í°ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¨ í™˜ì ë°ì´í„°

        // í˜ì´ì§€ ë¡œë“œ ì‹œ í† í° í™•ì¸ ë° í™˜ì ì •ë³´ ìë™ ì…ë ¥
        window.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const token = urlParams.get('token');

            if (token) {
                try {
                    // í† í°ìœ¼ë¡œ í™˜ì ì •ë³´ ì¡°íšŒ
                    const { data, error } = await supabase
                        .from('patients')
                        .select('*')
                        .eq('consent_token', token)
                        .single();

                    if (error) throw error;

                    if (data) {
                        patientData = data;

                        // í™˜ì ì •ë³´ ìë™ ì…ë ¥
                        document.getElementById('patientName').value = data.name;
                        document.getElementById('patientBirth').value = data.birth_year;

                        // ì½ê¸° ì „ìš©ìœ¼ë¡œ ì„¤ì • (ìˆ˜ì • ë¶ˆê°€)
                        document.getElementById('patientName').readOnly = true;
                        document.getElementById('patientBirth').readOnly = true;

                        // ìŠ¤íƒ€ì¼ ë³€ê²½ (ì½ê¸° ì „ìš© í‘œì‹œ)
                        document.getElementById('patientName').style.backgroundColor = '#f0f0f0';
                        document.getElementById('patientBirth').style.backgroundColor = '#f0f0f0';

                        // ë²•ì •ëŒ€ë¦¬ì¸ ì •ë³´ê°€ ìˆìœ¼ë©´ ìë™ ì…ë ¥
                        if (data.guardian_name) {
                            document.getElementById('guardianName').value = data.guardian_name;
                            document.getElementById('guardianPhone').value = data.guardian_phone || '';
                            document.getElementById('guardianRelation').value = data.guardian_relation || '';
                            guardianSection.classList.add('active');
                        }

                        // ë§Œ 14ì„¸ ë¯¸ë§Œ ì²´í¬
                        const currentYear = new Date().getFullYear();
                        const age = currentYear - parseInt(data.birth_year);
                        if (age < 14) {
                            guardianSection.classList.add('active');
                        }

                        // ì•ˆë‚´ ë©”ì‹œì§€ í‘œì‹œ (ê¸°ì¡´ ë‚´ìš© ìœ„ì— ì¶”ê°€)
                        const intro = document.querySelector('.intro');
                        const welcomeMsg = document.createElement('div');
                        welcomeMsg.style.cssText = 'background: #e6ffed; padding: 15px; border-radius: 6px; margin-bottom: 15px; border: 1px solid #48bb78;';
                        welcomeMsg.innerHTML = `
                            <p style="color: #48bb78; font-weight: 600; margin-bottom: 8px;">
                                âœ… ${data.name}ë‹˜ì˜ ë™ì˜ì„œì…ë‹ˆë‹¤
                            </p>
                            <p style="font-size: 13px; color: #2d3748;">
                                ì•„ë˜ ë‚´ìš©ì„ ê²€í† í•˜ì‹  í›„ ì„œëª…í•˜ì—¬ ì œì¶œí•´ ì£¼ì„¸ìš”.<br>
                                ì´ë¦„ê³¼ ìƒë…„ì›”ì¼ì€ ìë™ìœ¼ë¡œ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤.
                            </p>
                        `;
                        intro.insertBefore(welcomeMsg, intro.firstChild);
                    }
                } catch (error) {
                    console.error('í™˜ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    alert('ìœ íš¨í•˜ì§€ ì•Šì€ ë§í¬ì…ë‹ˆë‹¤. ì´ë©”ì¼ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.');
                }
            }
        });

        // ë™ì˜ ì—¬ë¶€ ì„ íƒ ì‹œ
        document.querySelectorAll('input[name="consent"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'agree') {
                    signatureSection.classList.add('active');
                } else {
                    signatureSection.classList.remove('active');
                    alert('ë™ì˜í•˜ì§€ ì•Šìœ¼ì‹œë©´ ì¼€ì´ìŠ¬ë¦½ì¼€ì–´(ìš´ì˜ì‚¬: ìˆ˜ë¯¸í—¬ìŠ¤) í”„ë¡œê·¸ë¨ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.');
                }
            });
        });

        // ìƒë…„ ì…ë ¥ ì‹œ ë§Œ 14ì„¸ ë¯¸ë§Œ ì²´í¬
        document.getElementById('patientBirth').addEventListener('input', function() {
            const birthYear = parseInt(this.value);
            const currentYear = new Date().getFullYear();
            const age = currentYear - birthYear;

            if (age < 14) {
                guardianSection.classList.add('active');
            } else {
                guardianSection.classList.remove('active');
            }
        });

        // Canvas ì„œëª… ê¸°ëŠ¥
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';

        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();

            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;

            ctx.lineTo(x, y);
            ctx.stroke();
            hasSignature = true;
            validateForm();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', stopDrawing);
        canvas.addEventListener('mouseout', stopDrawing);

        canvas.addEventListener('touchstart', startDrawing);
        canvas.addEventListener('touchmove', draw);
        canvas.addEventListener('touchend', stopDrawing);

        function clearSignature() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            hasSignature = false;
            validateForm();
        }

        function validateForm() {
            const name = document.getElementById('patientName').value.trim();
            const birth = document.getElementById('patientBirth').value;
            const agreed = document.querySelector('input[name="consent"]:checked')?.value === 'agree';

            if (agreed && name && birth && hasSignature) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        document.getElementById('patientName').addEventListener('input', validateForm);
        document.getElementById('patientBirth').addEventListener('change', validateForm);

        function submitForm() {
            const name = document.getElementById('patientName').value;
            const birthYear = document.getElementById('patientBirth').value;
            const guardianName = document.getElementById('guardianName').value;
            const guardianPhone = document.getElementById('guardianPhone').value;
            const guardianRelation = document.getElementById('guardianRelation').value;
            const kakaoConsent = document.getElementById('kakaoConsent').checked;

            // ë§Œ 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë²•ì •ëŒ€ë¦¬ì¸ ì •ë³´ í•„ìˆ˜
            const currentYear = new Date().getFullYear();
            const age = currentYear - parseInt(birthYear);

            if (age < 14 && (!guardianName || !guardianPhone)) {
                alert('ë§Œ 14ì„¸ ë¯¸ë§Œì¸ ê²½ìš° ë²•ì •ëŒ€ë¦¬ì¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // ì„œëª… ì´ë¯¸ì§€ ë°ì´í„°
            const signatureData = canvas.toDataURL();

            // ì „ì²´ ë™ì˜ì„œ HTML ìƒì„± (DB ì €ì¥ìš©)
            const fullConsentHTML = generateFullConsentHTML(name, birthYear, guardianName, guardianPhone, guardianRelation, kakaoConsent, signatureData);

            // ì œì¶œ ë²„íŠ¼ ë¹„í™œì„±í™”
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'ì œì¶œ ì¤‘...';

            // ì„œë²„ë¡œ ì „ì†¡
            fetch('https://ksleep-consent-backend.vercel.app/api/consent', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name,
                    birth: birthYear,
                    guardianName: guardianName || null,
                    guardianPhone: guardianPhone || null,
                    guardianRelation: guardianRelation || null,
                    kakaoChannelAgreed: kakaoConsent,
                    signatureData,
                    fullConsentHTML: fullConsentHTML,  // ì „ì²´ ë™ì˜ì„œ HTML ì¶”ê°€
                    timestamp: new Date().toISOString()
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    console.log('ì œì¶œ ì„±ê³µ:', data);

                    // ì˜ìˆ˜ì¦ ì •ë³´ ì €ì¥
                    submittedData = {
                        id: data.data.id,
                        name: name,
                        birthYear: birthYear,
                        submittedAt: data.data.submittedAt,
                        evidenceHash: data.data.evidenceHash,
                        signatureData: signatureData,
                        guardianName: guardianName || null,
                        guardianPhone: guardianPhone || null,
                        kakaoConsent: kakaoConsent
                    };

                    // localStorageì— ì €ì¥ (ë³‘ì› í™•ì¸ì„œì—ì„œ ì‚¬ìš©)
                    localStorage.setItem('lastConsentSubmission', JSON.stringify(submittedData));

                    // ì˜ìˆ˜ì¦ ì •ë³´ í‘œì‹œ
                    document.getElementById('receiptId').textContent = data.data.id;
                    document.getElementById('receiptTime').textContent = new Date(data.data.submittedAt).toLocaleString('ko-KR');
                    document.getElementById('receiptHash').textContent = data.data.evidenceHash ? data.data.evidenceHash.substring(0, 32) + '...' : '';

                    document.getElementById('successModal').style.display = 'block';

                    // í™˜ì ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ ë° í™•ì¸ì„œ ì´ë©”ì¼ ë°œì†¡ (í† í°ìœ¼ë¡œ ì ‘ì†í•œ ê²½ìš°)
                    if (patientData) {
                        updatePatientRecord(patientData.id);
                        sendConfirmationEmail(patientData.email, name, birthYear, signatureData, kakaoConsent, guardianName, guardianPhone, guardianRelation);
                    }
                } else {
                    alert('ì œì¶œ ì‹¤íŒ¨: ' + data.message);
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'ë™ì˜í•˜ê³  ì œì¶œí•˜ê¸°';
                }
            })
            .catch(error => {
                console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                alert('ì„œë²„ ì—°ê²° ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                submitBtn.disabled = false;
                submitBtn.textContent = 'ë™ì˜í•˜ê³  ì œì¶œí•˜ê¸°';
            });
        }

        function closeModal() {
            document.getElementById('successModal').style.display = 'none';
            // í¼ ì´ˆê¸°í™” ë˜ëŠ” ë‹¤ìŒ í˜ì´ì§€ë¡œ ì´ë™
            window.location.reload();
        }

        function downloadReceipt() {
            if (!submittedData) {
                alert('ì œì¶œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ì „ì²´ ë™ì˜ì„œ HTML ìƒì„± (generateFullConsentHTML í•¨ìˆ˜ ì¬ì‚¬ìš©)
            const fullConsentHTML = generateFullConsentHTML(
                submittedData.name,
                submittedData.birthYear,
                submittedData.guardianName,
                submittedData.guardianPhone,
                submittedData.guardianRelation || '',
                submittedData.kakaoConsent,
                submittedData.signatureData
            );

            // HTML íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([fullConsentHTML], { type: 'text/html;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ê°œì¸ì •ë³´ë™ì˜ì„œ_${submittedData.name}_${submittedData.id}.html`;
            link.click();

            alert('âœ… ë™ì˜ì„œê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në¸Œë¼ìš°ì €ì—ì„œ ì—´ì–´ ì¸ì‡„í•˜ê±°ë‚˜ PDFë¡œ ì €ì¥í•˜ì„¸ìš”.\n(íŒŒì¼ > ì¸ì‡„ > PDFë¡œ ì €ì¥)');
        }

        function openHospitalConfirmation() {
            if (!submittedData) {
                alert('ì œì¶œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë³‘ì›ìš© í™•ì¸ì„œ í˜ì´ì§€ë¥¼ ìƒˆ íƒ­ì—ì„œ ì—´ê¸°
            const url = 'hospital-confirmation.html';
            window.open(url, '_blank');
        }

        // ì „ì²´ ë™ì˜ì„œ HTML ìƒì„± í•¨ìˆ˜ (DB ì €ì¥ ë° ë‚˜ì¤‘ì— ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥)
        function generateFullConsentHTML(name, birthYear, guardianName, guardianPhone, guardianRelation, kakaoConsent, signatureData) {
            const currentDate = new Date().toLocaleString('ko-KR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Asia/Seoul'
            });

            const age = new Date().getFullYear() - parseInt(birthYear);
            const isMinor = age < 14;

            return `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ - ${name}</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Pretendard", -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #ffffff;
            padding: 40px 20px;
            line-height: 1.6;
        }
        .container { max-width: 900px; margin: 0 auto; background: white; border: 2px solid #2d3748; }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
            border-bottom: 4px solid #2d3748;
        }
        .header h1 { font-size: 28px; margin-bottom: 12px; font-weight: 700; }
        .header .subtitle { font-size: 16px; opacity: 0.95; font-weight: 500; }
        .content { padding: 40px 30px; }
        .section { margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0; }
        .section:last-child { border-bottom: none; }
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            padding-left: 12px;
            border-left: 4px solid #667eea;
        }
        .section-content { font-size: 14px; color: #4a5568; line-height: 1.8; }
        .section-content ul { margin: 10px 0; padding-left: 25px; }
        .section-content li { margin: 8px 0; }
        .info-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 12px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 15px 0;
        }
        .info-label { font-weight: 700; color: #495057; }
        .info-value { color: #2d3748; font-weight: 500; }
        .signature-box {
            background: #f8f9fa;
            border: 2px solid #cbd5e0;
            border-radius: 8px;
            padding: 25px;
            text-align: center;
            margin: 20px 0;
        }
        .signature-box h3 { font-size: 16px; color: #2d3748; margin-bottom: 15px; font-weight: 700; }
        .signature-image { max-width: 400px; border: 2px solid #cbd5e0; padding: 15px; background: white; border-radius: 8px; }
        .consent-status {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            border-radius: 8px;
            margin: 20px 0;
        }
        .footer {
            background: #2d3748;
            color: white;
            padding: 30px;
            text-align: center;
            font-size: 13px;
        }
        .footer p { margin: 5px 0; line-height: 1.6; }
        .highlight-box {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-size: 13px;
            color: #856404;
        }
        @media print {
            body { padding: 0; }
            .container { border: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ìˆ˜ì§‘Â·ì´ìš© ë™ì˜ì„œ</h1>
            <div class="subtitle">ì¼€ì´ìŠ¬ë¦½ì¼€ì–´ (ìˆ˜ë¯¸í—¬ìŠ¤)</div>
        </div>

        <div class="content">
            <div class="consent-status">
                âœ“ ë™ì˜ ì™„ë£Œ (${currentDate})
            </div>

            <div class="section">
                <div class="section-title">ë™ì˜ì ì •ë³´</div>
                <div class="info-grid">
                    <div class="info-label">ì„±ëª…</div>
                    <div class="info-value">${name}</div>
                    <div class="info-label">ìƒë…„</div>
                    <div class="info-value">${birthYear}ë…„ìƒ</div>
                    <div class="info-label">ì—°ë ¹</div>
                    <div class="info-value">${age}ì„¸</div>
                    ${isMinor && guardianName ? `
                    <div class="info-label">ë²•ì •ëŒ€ë¦¬ì¸</div>
                    <div class="info-value">${guardianName} (${guardianRelation || 'ê´€ê³„ ë¯¸ì…ë ¥'})</div>
                    <div class="info-label">ëŒ€ë¦¬ì¸ ì—°ë½ì²˜</div>
                    <div class="info-value">${guardianPhone}</div>
                    ` : ''}
                    <div class="info-label">ì¹´ì¹´ì˜¤í†¡ ìˆ˜ì‹  ë™ì˜</div>
                    <div class="info-value">${kakaoConsent ? 'ë™ì˜í•¨ âœ“' : 'ë™ì˜í•˜ì§€ ì•ŠìŒ'}</div>
                </div>
            </div>

            <div class="section">
                <div class="section-title">1. ìˆ˜ì§‘Â·ì´ìš© ëª©ì </div>
                <div class="section-content">
                    <strong>ìˆ˜ë©´ë¬´í˜¸í¡ì¦ ì§„ë‹¨ ë° ì¹˜ë£Œ ì§€ì›</strong>
                    <ul>
                        <li>PSG(ìˆ˜ë©´ë‹¤ì›ê²€ì‚¬) ê²°ê³¼ í™•ì¸ ë° í•´ì„ ì§€ì›</li>
                        <li>ì–‘ì••ê¸° ë° ê¸°íƒ€ ì¹˜ë£Œ ê³„íš ìˆ˜ë¦½ ë° ì¡°ì •</li>
                        <li>Mask fit í‰ê°€ ë° ë§ˆìŠ¤í¬ ì„ íƒÂ·êµì²´ ì§€ì›</li>
                        <li>ì–‘ì••ê¸° titration ë°ì´í„° í™•ì¸ ë° ìµœì  ì••ë ¥ ì¡°ì • ì§€ì›</li>
                        <li>ì–‘ì••ê¸° ì‚¬ìš© í˜„í™© ëª¨ë‹ˆí„°ë§ ë° ìˆœì‘ë„ ê´€ë¦¬</li>
                    </ul>
                    <strong>ë§ì¶¤í˜• ì¼€ì–´Â·êµìœ¡ ì œê³µ</strong>
                    <ul>
                        <li>ê²€ì‚¬Â·ì¹˜ë£Œ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ë§ì¶¤í˜• ì„¤ëª…Â·ë¦¬í¬íŠ¸ ì œê³µ</li>
                        <li>ìˆ˜ë©´Â·ìˆ˜ë©´ë¬´í˜¸í¡ì¦Â·ì¹˜ë£ŒÂ·ë³´í—˜ ê´€ë ¨ ì•ˆë‚´ ë° Q&A ì§€ì›</li>
                    </ul>
                    <strong>ì„œë¹„ìŠ¤ í’ˆì§ˆê´€ë¦¬ ë° ê°œì„ </strong>
                    <ul>
                        <li>ì¹˜ë£Œ ìˆœì‘ë„ ë° ì¦ìƒ ê°œì„  ë°ì´í„° ë¶„ì„</li>
                        <li>ë‚´ë¶€ í†µê³„Â·ë¶„ì„ì„ í†µí•œ í”„ë¡œê·¸ë¨Â·ì„œë¹„ìŠ¤ ê°œì„ </li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">2. ìˆ˜ì§‘Â·ì´ìš© í•­ëª©</div>
                <div class="section-content">
                    <strong>[1] ì¼ë°˜ ê°œì¸ì •ë³´</strong>
                    <ul>
                        <li>ì„±ëª…, ìƒë…„ì›”ì¼, ì„±ë³„</li>
                        <li>ì—°ë½ì²˜(íœ´ëŒ€ì „í™” ë²ˆí˜¸, ì´ë©”ì¼)</li>
                        <li>ë³‘ì› ê³ ê°ë²ˆí˜¸ ë“± í”„ë¡œê·¸ë¨ ìš´ì˜ì— í•„ìš”í•œ ì‹ë³„ ì •ë³´</li>
                    </ul>
                    <strong>[2] ê±´ê°• ê´€ë ¨ ë¯¼ê°ì •ë³´</strong>
                    <ul>
                        <li>PSG(ìˆ˜ë©´ë‹¤ì›ê²€ì‚¬) ê²°ê³¼ ì „ë°˜</li>
                        <li>ì–‘ì••ê¸° ë° ê´€ë ¨ ê²€ì‚¬/ì„¤ì • ë°ì´í„°</li>
                        <li>ì‹¤ì œ ì–‘ì••ê¸° ì‚¬ìš© ë°ì´í„°</li>
                        <li>ìˆ˜ë©´ ê´€ë ¨ ì„¤ë¬¸ ë° ê¸°ë¡</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">3. ë³´ìœ Â·ì´ìš© ê¸°ê°„</div>
                <div class="section-content">
                    <ul>
                        <li>ì¼€ì´ìŠ¬ë¦½ì¼€ì–´ í”„ë¡œê·¸ë¨ ì°¸ì—¬ ê¸°ê°„ ë™ì•ˆ ë° ì°¸ì—¬ ì¢…ë£Œ í›„ <strong>5ë…„ê°„</strong> ë³´ê´€</li>
                        <li>ê´€ë ¨ ë²•ë ¹ì— ë”°ë¼ ë” ê¸´ ê¸°ê°„ ë³´ì¡´ì´ í•„ìš”í•œ ê²½ìš°, í•´ë‹¹ ë²•ë ¹ì—ì„œ ì •í•œ ê¸°ê°„ ë™ì•ˆ ë³´ê´€Â·ì´ìš©</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">4. ì œ3ì ì œê³µ</div>
                <div class="section-content">
                    <strong>1) ì§„ë£Œ ë° í”„ë¡œê·¸ë¨ ìš´ì˜ì„ ìœ„í•œ ì œê³µ</strong>
                    <ul>
                        <li><strong>ì œê³µ ëŒ€ìƒ:</strong> ê³ ê°ì´ ê²€ì‚¬Â·ì§„ë£Œë¥¼ ë°›ì€ ìˆ˜ë©´í´ë¦¬ë‹‰ ë˜ëŠ” ë³‘ì›, ì¹˜ë£Œê¸°ê¸° ë° ì†Œëª¨í’ˆ ê³µê¸‰ì‚¬(DME) ë“±</li>
                        <li><strong>ì œê³µ ëª©ì :</strong> ì§„ë‹¨Â·ì¹˜ë£ŒÂ·ê²€ì‚¬ ë° í”„ë¡œê·¸ë¨ ìš´ì˜, ì¥ë¹„ ì„¸íŒ…Â·ìœ ì§€ê´€ë¦¬, ê¸°ìˆ  ì§€ì› ë“±</li>
                        <li><strong>ì œê³µ í•­ëª©:</strong> ì—…ë¬´ ìˆ˜í–‰ì— í•„ìš”í•œ ìµœì†Œí•œì˜ ë²”ìœ„</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <div class="section-title">5. ì •ë³´ì£¼ì²´ì˜ ê¶Œë¦¬</div>
                <div class="section-content">
                    <p>ê·€í•˜ëŠ” ì–¸ì œë“ ì§€ ë‹¤ìŒ ì‚¬í•­ì— ëŒ€í•´ ìˆ˜ë¯¸í—¬ìŠ¤ì— ìš”êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:</p>
                    <ul>
                        <li>ê°œì¸ì •ë³´ ë° ë¯¼ê°ì •ë³´ ì—´ëŒ</li>
                        <li>ì •ì •Â·ì‚­ì œ ìš”ì²­</li>
                        <li>ì²˜ë¦¬ ì •ì§€ ìš”ì²­</li>
                    </ul>
                    <p style="margin-top: 10px;">ì—°ë½ì²˜: contact@ksleep.care / 010-9796-2513</p>
                </div>
            </div>

            <div class="signature-box">
                <h3>ì „ì ì„œëª…</h3>
                <img src="${signatureData}" alt="ì„œëª…" class="signature-image" />
                <p style="margin-top: 15px; font-size: 13px; color: #6c757d;">ì„œëª…ì¼: ${currentDate}</p>
            </div>
        </div>

        <div class="footer">
            <p><strong>ìˆ˜ë¯¸í—¬ìŠ¤(SOOMi Health)</strong></p>
            <p>ì„œë¹„ìŠ¤ëª…: ì¼€ì´ìŠ¬ë¦½ì¼€ì–´ | ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 889-43-01165</p>
            <p>ëŒ€í‘œìëª…Â·ê°œì¸ì •ë³´ë³´í˜¸ì±…ì„ì: ê¹€ì—°ì¬</p>
            <p>ì£¼ì†Œ: ì„œìš¸íŠ¹ë³„ì‹œ ì˜ë“±í¬êµ¬ ì–‘í‰ë¡œ 24, 5ì¸µ (Korea)</p>
            <p>ì´ë©”ì¼: contact@ksleep.care | ì „í™”: 010-9796-2513</p>
            <p style="margin-top: 15px; font-size: 11px; opacity: 0.8;">
                CopyrightÂ© 2025 ìˆ˜ë¯¸í—¬ìŠ¤ All rights reserved
            </p>
        </div>
    </div>
</body>
</html>`;
        }

        // í™˜ì ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ (ë™ì˜ì„œ ì™„ë£Œ í‘œì‹œ)
        async function updatePatientRecord(patientId) {
            try {
                const { error } = await supabase
                    .from('patients')
                    .update({
                        consent_completed: true
                    })
                    .eq('id', patientId);

                if (error) throw error;
                console.log('í™˜ì ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
            } catch (error) {
                console.error('í™˜ì ë ˆì½”ë“œ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
            }
        }

        // í™˜ìì—ê²Œ í™•ì¸ì„œ ì´ë©”ì¼ ë°œì†¡
        async function sendConfirmationEmail(email, name, birthYear, signatureData, kakaoConsent, guardianName, guardianPhone, guardianRelation) {
            try {
                const emailResponse = await fetch('/api/send-confirmation-email', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email,
                        name,
                        birthYear,
                        signatureData,
                        kakaoConsent,
                        guardianName,
                        guardianPhone,
                        guardianRelation
                    })
                });

                if (emailResponse.ok) {
                    console.log('í™•ì¸ì„œ ì´ë©”ì¼ ë°œì†¡ ì™„ë£Œ:', email);
                } else {
                    const error = await emailResponse.text();
                    console.error('ì´ë©”ì¼ ë°œì†¡ ì‹¤íŒ¨:', error);
                }
            } catch (error) {
                console.error('í™•ì¸ì„œ ì´ë©”ì¼ ë°œì†¡ ì˜¤ë¥˜:', error);
            }
        }
    </script>
</body>
</html>